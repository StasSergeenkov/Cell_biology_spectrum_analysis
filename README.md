# Cell_biology_spectrum_analysis
# Анализ сходства УФ-ВИС спектров: математическое описание алгоритмов

## 1. Общая методология анализа

Приложение реализует **метод нормированной кросс-корреляции** для оценки сходства спектров, специально разработанный для данных УФ-ВИС спектроскопии с возможными вариациями интенсивности и незначительными сдвигами по длине волны.

### 1.1 Математическое представление данных
Каждый спектр представляется как дискретный сигнал:
- **X** = {x₁, x₂, ..., xₙ} : значения длин волн (190-700 нм, Δλ = 1 нм)
- **Y** = {y₁, y₂, ..., yₙ} : значения оптической плотности

Для каждого вещества *i* спектральные данные определяются как:
**Sᵢ** = {(xⱼ, yⱼᵢ) | j = 1, 2, ..., n}, где n = 511 (диапазон 190-700 нм с шагом 1 нм)

## 2. Алгоритмы предобработки данных

### 2.1 Нормализация спектров
Для устранения влияния концентрации на абсолютные значения оптической плотности применяется нормализация:

**Нормализация по максимуму:**
```
ŷᵢ = yᵢ / max(yᵢ), где max(yᵢ) = максимум{y₁ᵢ, y₂ᵢ, ..., yₙᵢ}
```

**Нормализация по площади (альтернативный метод):**
```
ŷᵢ = yᵢ / ∫ yᵢ dx ≈ yᵢ / ∑ⱼ (yⱼᵢ + yⱼ₊₁ᵢ)/2 · Δx
```
где интегрирование аппроксимируется методом трапеций.

### 2.2 Проверка согласованности данных
Алгоритм проверяет соответствие размерностей спектров:
```
n_неизвестного = длина(Y_неизвестного)
n_известного = длина(Y_известного)
если n_неизвестного ≠ n_известного → выводится предупреждение
```
Интерполяция и коррекция базовой линии в текущей реализации не применяются.

## 3. Метрика сходства: нормированная кросс-корреляция

### 3.1 Функция кросс-корреляции
Для неизвестного спектра **U** и известного спектра **K** (оба нормализованы) кросс-корреляция вычисляется как:
```
R[m] = ∑ⱼ ŷⱼᵘ · ŷⱼ₊ₘᵏ, где m = -M, ..., M
```
где `M = n//2`, а вычисление использует параметр `mode='same'` для сохранения исходной длины векторов.

### 3.2 Схема нормировки
Максимальное значение корреляции нормируется на геометрическое среднее энергий сигналов:
```
φ = max(R) / √(∑ⱼ (ŷⱼᵘ)² · ∑ⱼ (ŷⱼᵏ)²)
```
Это дает коэффициент сходства φ ∈ [0, 1], где:
- φ = 1 означает идентичную форму спектров (с учетом масштабирования амплитуды)
- φ = 0 означает ортогональные сигналы

### 3.3 Вычислительная реализация
Алгоритм использует быстрое преобразование Фурье (БПФ) для вычисления корреляции через функцию `scipy.signal.correlate`, обеспечивая вычислительную сложность O(n log n) вместо O(n²).

## 4. Методология сравнительного анализа

### 4.1 Матрица попарных сравнений
Для каждого неизвестного вещества *u* и набора известных веществ {k₁, k₂, k₃, k₄} алгоритм вычисляет:
```
Φ = [φ(u, k₁), φ(u, k₂), φ(u, k₃), φ(u, k₄)]
```

### 4.2 Протокол ранжирования
Вещества ранжируются по убыванию коэффициента сходства:
```
ранг(kᵢ) = позиция φ(u, kᵢ) в отсортированном(Φ, по убыванию)
```
Возможны совпадения значений, но маловероятны при непрерывных значениях φ.

## 5. Статистические свойства метрики сходства

### 5.1 Свойства инвариантности
Реализованная метрика обладает:
- **Инвариантностью к масштабу**: φ(αU, βK) = φ(U, K) для α, β > 0
- **Чувствительностью к сдвигу**: Небольшие сдвиги по длине волны нелинейно уменьшают φ
- **Симметрией**: φ(U, K) = φ(K, U) в пределах точности вычислений

### 5.2 Сравнение с альтернативными метриками
Для контекста (в коде не реализовано):

| Метрика | Формула | Чувствительность к интенсивности | Чувствительность к сдвигу |
|---------|---------|-----------------------------------|----------------------------|
| **Кросс-корреляция** | φ = max(Ũ ⋆ K̃)/‖Ũ‖‖K̃‖ | Инвариантна | Чувствительна |
| Корреляция Пирсона | ρ = cov(U,K)/(σᵤσₖ) | Чувствительна | Сильно чувствительна |
| Косинусное сходство | cos θ = U·K/(‖U‖‖K‖) | Инвариантна | Чувствительна |
| Евклидово расстояние | d = ‖U - K‖₂ | Чувствительна | Сильно чувствительна |

Выбранный метод оптимально балансирует устойчивость к сдвигам и инвариантность к интенсивности для задач УФ-ВИС спектроскопии.

## 6. Структура выходных данных

### 6.1 Основные результаты
```
Результаты = {
    неизвестное_вещество: [
        (известное_вещество₁, φ₁, путь_к_файлу₁, ранг₁),
        (известное_вещество₂, φ₂, путь_к_файлу₂, ранг₂),
        ...
    ]
}
```

### 6.2 Визуализация результатов
Для наиболее похожего известного вещества k_top:
- Графики нормализованной оптической плотности: ŷᵘ vs ŷᵏᵗᵒᵖ от λ
- Графическое представление сохраняется в PNG со стандартизированным форматированием

## 7. Ограничения и допущения алгоритма

### 7.1 Известные ограничения
1. **Фиксированный диапазон длин волн**: Предполагает одинаковые λ_min, λ_max и Δλ
2. **Отсутствие коррекции базовой линии**: Предполагает нулевое поглощение на базовой линии
3. **Отсутствие моделирования шума**: Предполагает постоянное отношение сигнал/шум во всех измерениях
4. **Равное взвешивание**: Все области спектра вносят равный вклад в φ

### 7.2 Вычислительная сложность
- Временная сложность: O(p·q·n log n) для p неизвестных и q известных веществ
- Пространственная сложность: O(n) на одно сравнение
- Для n=511, p≤2, q=4: вычислительная нагрузка незначительна (<100 мс)

## 8. Возможности расширения

Модульная архитектура допускает простую реализацию:
- Альтернативных схем нормализации (SNV, MSC)
- Выравнивания длин волн через сопоставление пиков
- Проверки статистической значимости через перестановочные методы
- Консенсусного сопоставления по нескольким спектрам

Данная реализация обеспечивает надежную, математически прозрачную основу для оценки сходства спектров в задачах аналитической спектроскопии.
